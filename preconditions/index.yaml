# Precondition Definitions Index
# Registry of all precondition types with metadata for quick reference
# v3.0.0 - Consolidated types

schema_version: "3.0"
definition_file: preconditions.yaml

# Remote extension definitions (public URLs)
# Users can add custom preconditions from external sources
remote_sources:
  # Example: Custom CI/CD preconditions
  # - url: https://raw.githubusercontent.com/hiivmind/blueprint-ci/main/preconditions.yaml
  #   types: [pipeline_passed, artifact_exists, deployment_ready]

types:
  # ==========================================================================
  # Core - Composite (4 types)
  # ==========================================================================
  all_of:
    category: core/composite
    brief: All nested conditions must be true (AND)
    required_params: [conditions]

  any_of:
    category: core/composite
    brief: At least one condition must be true (OR)
    required_params: [conditions]

  none_of:
    category: core/composite
    brief: No conditions may be true (NOR)
    required_params: [conditions]

  xor_of:
    category: core/composite
    brief: Exactly one condition must be true (XOR)
    required_params: [conditions]

  # ==========================================================================
  # Core - Expression (1 type)
  # ==========================================================================
  evaluate_expression:
    category: core/expression
    brief: Evaluate arbitrary boolean expression
    required_params: [expression]
    note: Use len() for array counts (replaces count_equals, count_above, count_below)

  # ==========================================================================
  # Core - Filesystem (1 type) - CONSOLIDATED in v3.0
  # ==========================================================================
  path_check:
    category: core/filesystems
    brief: Check path existence and type
    required_params: [path, check]
    replaces: [config_exists, index_exists, index_is_placeholder, file_exists, directory_exists]

  # ==========================================================================
  # Core - Logging (1 type) - CONSOLIDATED in v3.0
  # ==========================================================================
  log_state:
    category: core/logging
    brief: Check logging lifecycle state
    required_params: [aspect]
    replaces: [log_initialized, log_level_enabled, log_finalized]

  # ==========================================================================
  # Core - State (1 type) - CONSOLIDATED in v3.0
  # ==========================================================================
  state_check:
    category: core/state
    brief: Check state field values with various operators
    required_params: [field, operator]
    replaces: [flag_set, flag_not_set, state_equals, state_not_null, state_is_null]

  # ==========================================================================
  # Core - Tools (2 types) - tool_check CONSOLIDATED in v3.0
  # ==========================================================================
  tool_check:
    category: core/tools
    brief: Check tool availability and capabilities
    required_params: [tool, capability]
    replaces: [tool_available, tool_version_gte, tool_authenticated, tool_daemon_ready]

  python_module_available:
    category: core/python
    brief: Check if Python module is installed
    required_params: [module]

  # ==========================================================================
  # Core - Network (1 type)
  # ==========================================================================
  network_available:
    category: core/network
    brief: Check if network access is available
    required_params: []

  # ==========================================================================
  # Core - Git (1 type) - CONSOLIDATED in v3.0
  # ==========================================================================
  source_check:
    category: core/git
    brief: Check source repository state
    required_params: [source_id, aspect]
    replaces: [source_exists, source_cloned, source_has_updates]

  # ==========================================================================
  # Core - Web Fetch (1 type) - CONSOLIDATED in v3.0
  # ==========================================================================
  fetch_check:
    category: core/web_fetch
    brief: Check web fetch result state
    required_params: [from, aspect]
    replaces: [fetch_succeeded, fetch_returned_content]

# Eliminated types (use evaluate_expression instead)
# - count_equals -> evaluate_expression: "len(field) == N"
# - count_above  -> evaluate_expression: "len(field) > N"
# - count_below  -> evaluate_expression: "len(field) < N"

# Statistics
stats:
  total_types: 14
  consolidated_from: 27
  eliminated: 3  # count_equals, count_above, count_below
